replicaCount: 1

email: ""

# Namespace for the deployment
namespace: ""

image:
  backend:
    repository: openpoliticsproject/backend
    tag: "latest"
    pullPolicy: Always
    nodes: 1
  frontend: 
    repository: openpoliticsproject/frontend
    tag: "latest"
    pullPolicy: Always
  celery-worker:
    repository: openpoliticsproject/backend
    tag: "latest"
    pullPolicy: Always
  postgres:
    image: pgvector/pgvector
    tag: "pg17"
    pullPolicy: IfNotPresent
    nodes: 1
  redis:
    image: redis
    tag: "alpine"
    pullPolicy: IfNotPresent
  minio:
    image: minio/minio
    tag: "latest"
    pullPolicy: IfNotPresent
    nodes: 0
  nominatim:
    nodes: 0
    image: mediagis/nominatim
    tag: "5.1"
    pullPolicy: IfNotPresent

# Image pull secrets (if using private registry)
# imagePullSecrets:
#   - name: regcred

service:
  type: ClusterIP
  port: 80


ingress:
  enabled: true
  className: traefik
  annotations:
    # Traefik built-in ACME SSL (no cert-manager needed!)
    traefik.ingress.kubernetes.io/router.tls: "true"
    traefik.ingress.kubernetes.io/router.tls.certresolver: "letsencrypt"
    traefik.ingress.kubernetes.io/router.entrypoints: "web,websecure"
    # Explicit domain specification for Traefik v3+
    traefik.ingress.kubernetes.io/router.tls.domains.0.main: ""
    traefik.ingress.kubernetes.io/router.tls.domains.0.sans: "www."
    # Traefik handles HTTPâ†’HTTPS redirect via boot.sh HelmChartConfig
    # Session affinity
    traefik.ingress.kubernetes.io/service.sticky.cookie: "true"
    traefik.ingress.kubernetes.io/service.sticky.cookie.name: "open-politics-session"
  host: ""
  path: /
  tls:
    # Let Traefik ACME manage TLS; leave secretName unset
    secretName: ""

postgres:
  postgresqlDatabase: opp_app_users
  postgresqlUser: postgres
  postgresqlPassword: "924qmgzbq"
  service:
    port: 5432
  # Persistent storage for Postgres
  persistence:
    enabled: true
    storageClass: "hcloud-volumes"
    size: 20Gi
    accessMode: ReadWriteOnce

redis:
  service:
    port: 6379
  # Persistent storage for Redis
  persistence:
    enabled: true
    storageClass: "local-path"
    size: 8Gi
    accessMode: ReadWriteOnce

configmaps:
  stack:
    name: stack-config
  redis:
    name: redis-config

env:
  config:
    DOMAIN: "open-politics.org"
    ENVIRONMENT: "production"
    FRONTEND_PORT: "3000"
    BACKEND_PORT: "8022"
    REDIS_PORT: "6379"
    PROJECT_NAME: "Open Politics Project"
    STACK_NAME: "open-politics-prod-stack"
    BACKEND_CORS_ORIGINS: "http://localhost,http://localhost:5173,https://localhost,https://localhost:3000,http://localhost.tiangolo.com,http://open-politics.org,https://open-politics.org,https://open-politics.org:80,https://open-politics.org:443"
    MINIO_ENDPOINT: ""
    MINIO_HOST: "minio"
    MINIO_PORT: "9000"
    MINIO_SECURE: "true"
  secrets:
    SECRET_KEY: ""
    FIRST_SUPERUSER: "jimvw@open-politics.org"
    FIRST_SUPERUSER_PASSWORD: ""
    USERS_OPEN_REGISTRATION: "false"
    POSTGRES_SERVER: "postgres"
    POSTGRES_DB: "opp_app_users_prod"
    POSTGRES_USER: "postgres"
    POSTGRES_PORT: "5432"
    POSTGRES_PASSWORD: ""
    POSTGRES_SSL_MODE: ""
    REDIS_HOST: redis
    REDIS_PORT: 6379
    REDIS_DB: 0
    REDIS_PASSWORD: ""
    # Optional: Override with full URL (takes precedence if set)
    ## Optional Redis override
    #REDIS_URL=redis://my-redis-host.aws.com:6379/0
    # or rediss://... for TLS
    # or redis://user:pass@host:port/db for auth
    DISCOURSE_CONNECT_ENABLED: "false"
    DISCOURSE_CONNECT_SECRET: ""
    DISCOURSE_CONNECT_URL: ""
    MAPBOX_ACCESS_TOKEN: ""
    MINIO_ROOT_USER: ""
    MINIO_ROOT_PASSWORD: ""
    MINIO_BUCKET_NAME: "hq-user-storage-prod"
    MINIO_REGION: "eu-central"
    MINIO_ACCESS_KEY: ""
    MINIO_SECRET_KEY: ""
    MINIO_USE_SSL: "true"
    MINIO_SITE_NAME: "nbg1"
    MINIO_SITE_REGION: "eu-central"
    SMTP_HOST: "smtp.protonmail.ch"
    SMTP_PORT: "587"
    SMTP_TLS: "true"
    SMTP_USER: ""
    SMTP_PASSWORD: ""
    EMAILS_FROM_EMAIL: ""
    SMTP_SSL: "false"
    EMAILS_FROM_NAME: "HQ"
    REQUIRE_EMAIL_VERIFICATION: "false"
    SENTRY_DSN: ""
    OPENAI_API_KEY: ""
    GOOGLE_API_KEY: ""
    TAVILY_API_KEY: ""
    WIPE_DB: "False"

# Traefik Configuration (k3s native)
# Using Traefik with built-in ACME for maximum efficiency - no cert-manager needed!

# MinIO Configuration (local deployment)
minio:
  service:
    type: ClusterIP
    port: 9000
    nodePort: null
  consoleService:
    type: ClusterIP
    port: 9001
    nodePort: null
  persistence:
    enabled: true
    storageClass: "local-path"
    size: 50Gi
    accessMode: ReadWriteOnce
  command:
    - /bin/bash
    - -c
  args:
    - minio server /data --console-address :9001

# Resource limits and requests
resources:
  backend:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  frontend:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  celery:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  postgres:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  redis:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 512Mi


nominatim:
  service:
    type: ClusterIP
    port: 8721
  # For Europe detailed (10 min import, address-level)
  pbfUrl: "https://download.geofabrik.de/europe-latest.osm.pbf"
  replicationUrl: "https://download.geofabrik.de/europe-updates/"
  importStyle: "admin"
  # For world coarse (2h import, city/district-level) - DEFAULT alternative:
  # pbfUrl: "https://planet.openstreetmap.org/pbf/planet-latest.osm.pbf"
  # replicationUrl: "https://planet.openstreetmap.org/replication/day/"
  # importStyle: "admin"
  persistence:
    enabled: true
    storageClass: "hcloud-volumes"
    dataSize: 100Gi
    workSize: 80Gi
    accessMode: ReadWriteOnce

# Node affinity (optional - spread across nodes)
nodeAffinity:
  enabled: true

# Pod disruption budgets
podDisruptionBudget:
  enabled: true
  minAvailable: 1
